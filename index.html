import React, { useState, useEffect } from 'react';
import { 
  ShieldCheck, 
  LayoutDashboard, 
  Grid, 
  Cpu, 
  Settings, 
  Search, 
  Bell, 
  User, 
  ChevronRight, 
  FileText, 
  Languages, 
  Gavel, 
  FileCheck, 
  Activity, 
  AlertCircle, 
  CheckCircle2, 
  Clock, 
  Upload, 
  Send,
  FolderOpen,
  FileSignature,
  Filter,
  ArrowRightLeft,
  Download,
  FileSearch,
  BookOpen,
  Type,
  Maximize2,
  Users,
  Briefcase,
  CheckSquare,
  SearchCode,
  FileDown,
  ArrowRight,
  Zap,
  BarChart3,
  Globe,
  Lock,
  RefreshCw,
  MoreVertical,
  Sliders,
  Terminal,
  Code2,
  History,
  Info,
  UserPlus,
  Link2,
  Eye,
  FileWarning,
  Database,
  Server,
  Network
} from 'lucide-react';

// --- 全局安全状态栏 ---
const SecurityHeader = () => (
  <div className="bg-slate-900 text-white px-6 py-2 flex items-center justify-between text-sm border-b border-slate-700">
    <div className="flex items-center space-x-4">
      <div className="flex items-center text-emerald-400">
        <ShieldCheck size={16} className="mr-2" />
        <span>本地脱敏网关：实时保护中</span>
      </div>
      <div className="h-4 w-px bg-slate-700"></div>
      <div className="flex items-center space-x-2">
        <span className="text-slate-400">策略：</span>
        <span className="bg-blue-900/50 text-blue-300 px-2 py-0.5 rounded text-xs border border-blue-700">NER 增强模式</span>
      </div>
      <div className="flex items-center space-x-2">
        <span className="text-slate-400">已隐藏：</span>
        <span className="text-slate-300">姓名、金额、案号、联系方式</span>
      </div>
    </div>
    <div className="flex items-center space-x-4">
      <div className="flex items-center text-emerald-400 text-xs">
        <Activity size={12} className="mr-1 animate-pulse" />
        VPC 专线已连接 (延迟: 42ms)
      </div>
      <button className="text-xs bg-slate-800 hover:bg-slate-700 px-2 py-1 rounded transition">审计日志</button>
    </div>
  </div>
);

// --- 1. 证券底稿核查 Agent ---
const SecuritiesAgent = () => {
  const [messages, setMessages] = useState([
    { role: 'ai', text: '您好，证券底稿核查 Agent 已就绪。您可以批量上传底稿文件夹或提问。' },
    { role: 'ai', text: '当前正在执行：【天元环保 IPO 专项巡检】\n扫描发现 2 处逻辑冲突及 1 处关键附件缺失，请查看右侧文件树。' }
  ]);
  const [input, setInput] = useState('');

  const fileTree = [
    { name: '01-环保行政处罚核查说明.docx', status: 'ok', risk: null },
    { name: '02-访谈记录-安全生产主管.pdf', status: 'risk', risk: '缺少访谈人签字', color: 'red' },
    { name: '03-政府官网核查截图.png', status: 'warn', risk: '效期预警 (已超过3个月)', color: 'amber' },
    { name: '04-危废处理合同(2025).pdf', status: 'ok', risk: null },
    { name: '05-项目危废台账.xlsx', status: 'warn', risk: '数据与意见书不一致', color: 'amber' },
  ];

  const handleSend = () => {
    if (!input.trim()) return;
    const newMsgs = [...messages, { role: 'user', text: input }];
    setMessages(newMsgs);
    setInput('');
    setTimeout(() => {
      setMessages([...newMsgs, { role: 'ai', text: "本地脱敏已完成。经核查，您提到的 05 卷中的数据确实与法律意见书第 42 页存在 5% 的偏差，建议复核访谈记录。" }]);
    }, 800);
  };

  return (
    <div className="h-full flex animate-in zoom-in-95 duration-500 overflow-hidden">
      <div className="flex-1 flex flex-col bg-white border-r border-slate-200">
        <div className="px-6 py-4 border-b border-slate-100 flex items-center justify-between">
          <div className="flex items-center space-x-2">
            <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white"><FileCheck size={18} /></div>
            <div><h3 className="text-sm font-bold text-slate-800">证券底稿核查 Agent</h3><p className="text-[10px] text-emerald-500">正在进行一致性比对...</p></div>
          </div>
        </div>
        <div className="flex-1 overflow-y-auto p-6 space-y-4">
          {messages.map((m, i) => (
            <div key={i} className={`flex ${m.role === 'ai' ? 'justify-start' : 'justify-end'}`}>
              <div className={`max-w-[80%] p-4 rounded-2xl text-sm ${m.role === 'ai' ? 'bg-slate-100 text-slate-800' : 'bg-slate-900 text-white shadow-lg'}`}>{m.text}</div>
            </div>
          ))}
        </div>
        <div className="p-4 border-t border-slate-100 bg-slate-50/50">
          <div className="relative">
            <textarea value={input} onChange={(e) => setInput(e.target.value)} className="w-full bg-white border border-slate-200 rounded-2xl p-4 text-sm outline-none min-h-[100px] resize-none pr-12" placeholder="请输入您的问题..." />
            <button onClick={handleSend} className="absolute bottom-4 right-4 p-2 bg-blue-600 text-white rounded-xl shadow-lg hover:bg-blue-700 transition-colors"><Send size={18} /></button>
          </div>
        </div>
      </div>
      <div className="w-[380px] bg-slate-50 flex flex-col border-l border-slate-200 overflow-y-auto">
        <div className="p-6 bg-white border-b"><h3 className="text-xs font-bold text-slate-400 uppercase tracking-widest font-mono">底稿资产与风险地图</h3></div>
        <div className="p-4 space-y-2">
           <div className="flex items-center text-sm font-bold p-2 hover:bg-slate-100 rounded-xl cursor-pointer"><FolderOpen size={16} className="mr-2 text-amber-500" /> 天元 IPO 项目环保底稿</div>
           <div className="pl-6 space-y-1">
              {fileTree.map((f, i) => (
                <div key={i} className="p-2 rounded-xl hover:bg-slate-200 transition group cursor-pointer">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center text-xs truncate"><FileText size={14} className="mr-2 text-slate-400" />{f.name}</div>
                    {f.status !== 'ok' && <div className={`w-2 h-2 rounded-full bg-${f.color}-500 animate-pulse`}></div>}
                  </div>
                  {f.risk && <p className={`text-[10px] text-${f.color}-600 font-bold mt-1`}>⚠ {f.risk}</p>}
                </div>
              ))}
           </div>
        </div>
      </div>
    </div>
  );
};

// --- 2. 高保真法律翻译 ---
const LegalTranslation = () => {
  return (
    <div className="h-full flex flex-col bg-slate-100 overflow-hidden">
      <div className="px-6 py-3 bg-white border-b flex items-center justify-between">
        <div className="flex items-center space-x-4 text-xs font-bold">
           <div className="bg-slate-100 px-3 py-1 rounded-lg">中文 (简体) {'->'} 英语 (UK)</div>
           <div className="h-4 w-px bg-slate-300"></div>
           <span className="text-purple-600 flex items-center"><Zap size={14} className="mr-1"/> Layout-aware 模式：已激活</span>
        </div>
        <button className="bg-purple-600 text-white px-4 py-1.5 rounded-xl text-xs font-bold shadow-lg shadow-purple-900/20 hover:bg-purple-700 transition-colors">下载 1:1 还原文档</button>
      </div>
      <div className="flex-1 flex p-6 space-x-6 overflow-hidden">
         <div className="flex-1 bg-white rounded-3xl shadow-xl border border-slate-200 p-8 overflow-y-auto opacity-60 select-none">
            <h4 className="text-[10px] font-bold text-slate-400 mb-6 uppercase tracking-widest">原文预览</h4>
            <div className="space-y-4 font-serif text-sm">
               <p className="text-lg font-bold text-center">股权转让协议</p>
               <p>“关联方”指对任何一方而言，直接或间接控制该方、受该方控制或与该方共同受控制的任何实体。</p>
            </div>
         </div>
         <div className="flex-1 bg-white rounded-3xl shadow-xl border border-purple-200 p-8 overflow-y-auto">
            <h4 className="text-[10px] font-bold text-purple-400 mb-6 uppercase tracking-widest">1:1 镜像译文</h4>
            <div className="space-y-4 font-serif text-sm text-slate-800">
               <p className="text-lg font-bold text-center">Equity Transfer Agreement</p>
               <p>"<span className="bg-amber-100 px-1 rounded">Related Party</span>" means, with respect to any party, any entity that directly or indirectly controls, is controlled by, or is under common control with such party.</p>
               <div className="w-full h-32 border border-dashed border-slate-200 rounded-2xl flex items-center justify-center text-slate-300 italic text-[10px]">此处已 1:1 还原原始印章布局</div>
            </div>
         </div>
      </div>
    </div>
  );
};

// --- 3. 智能投标制作 ---
const BiddingAgent = () => {
  return (
    <div className="h-full flex animate-in slide-in-from-right-4">
      <div className="w-64 border-r bg-slate-50/50 p-6 space-y-8">
         <div className="text-[11px] font-bold text-indigo-600 flex items-center"><CheckCircle2 size={16} className="mr-2"/> 步骤 1：素材抓取已完成</div>
         <div className="text-[11px] font-bold text-indigo-600 flex items-center"><CheckCircle2 size={16} className="mr-2"/> 步骤 2：模版补全已完成</div>
         <div className="text-[11px] font-bold text-indigo-600 flex items-center border-l-2 border-indigo-600 pl-4 py-1">步骤 3：智能审核与合规巡检</div>
      </div>
      <div className="flex-1 flex overflow-hidden">
         <div className="flex-1 bg-slate-200/30 p-8 overflow-y-auto">
            <div className="bg-white max-w-2xl mx-auto shadow-2xl p-12 min-h-[600px] border border-slate-200 font-serif">
               <h2 className="text-2xl font-bold text-center mb-10">投标文件 (草案)</h2>
               <div className="space-y-6 text-sm leading-relaxed">
                  <p className="bg-indigo-50 p-4 border-l-4 border-indigo-400 text-slate-600 italic">AI 已根据 RFP 需求，自动填充了 2024 年本所在证券业务领域的 5 个标杆案例。</p>
                  <p>本团队由 <b>王大明</b> 合伙人牵头，该律师在过去三年内已为超过 20 家拟上市公司提供法律服务...</p>
               </div>
            </div>
         </div>
         <div className="w-80 bg-white border-l p-6 space-y-6">
            <h4 className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">智能响应审核</h4>
            <div className="bg-emerald-50 p-4 rounded-2xl border border-emerald-100 text-[11px] text-emerald-800">
               ✓ 招标文件要求的 15 项法律服务条款已全部精准响应，无漏项风险。
            </div>
            <div className="bg-amber-50 p-4 rounded-2xl border border-amber-100 text-[11px] text-amber-800">
               ⚠ 发现 2 处违规用语：包含“行业最强”等绝对化词汇，建议修改。
            </div>
            <button className="w-full py-3 bg-indigo-600 text-white rounded-2xl font-bold text-xs shadow-xl hover:bg-indigo-700 transition-colors">导出最终标书 (.docx)</button>
         </div>
      </div>
    </div>
  );
};

// --- 4. 利益冲突检索 ---
const ConflictSearch = () => {
  const [results] = useState({
    risk: 'high',
    entities: [{ name: '腾讯控股', relation: '母公司', status: '历史曾代' }, { name: '腾讯科技', relation: '当前案件关联', status: '利益冲突' }]
  });
  return (
    <div className="p-8 max-w-4xl mx-auto space-y-8 animate-in fade-in">
       <div className="bg-white p-8 rounded-[40px] shadow-2xl border border-slate-100 space-y-6">
          <div className="relative">
             <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" />
             <input type="text" defaultValue="腾讯控股有限公司" className="w-full pl-12 pr-4 py-4 bg-slate-50 rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none font-bold" />
          </div>
          <div className="p-6 bg-red-50 border border-red-100 rounded-3xl flex items-center space-x-4">
            <FileWarning size={32} className="text-red-600" />
            <div>
              <h4 className="font-bold text-red-800">冲突结论：高风险</h4>
              <p className="text-xs text-red-600 opacity-80 italic">发现 2 个穿透式关联方与我所当前在办案件存在对立利益。</p>
            </div>
          </div>
          <div className="space-y-4">
             <h4 className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">关联实体穿透图</h4>
             <div className="grid grid-cols-2 gap-4">
                {results.entities.map((e, i) => (
                   <div key={i} className="p-4 bg-slate-50 rounded-2xl border border-slate-100 flex justify-between items-center">
                      <div><p className="text-sm font-bold">{e.name}</p><p className="text-[10px] text-slate-400">{e.status}</p></div>
                      <span className="text-[10px] bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full font-bold">{e.relation}</span>
                   </div>
                ))}
             </div>
          </div>
       </div>
    </div>
  );
};

// --- 5. 模型沙盒 (Qwen/自有模型测试) ---
const ModelSandbox = ({ model, onBack }) => {
  const [messages, setMessages] = useState([
    { role: 'ai', text: `您好，我是 ${model.name}。已链接律所 VPC 专用加密通道。您可以开始测试 Prompt 指令。` }
  ]);
  const [input, setInput] = useState('');

  const handleSend = () => {
    if (!input.trim()) return;
    const newMsgs = [...messages, { role: 'user', text: input }];
    setMessages(newMsgs);
    setInput('');
    setTimeout(() => {
      setMessages([...newMsgs, { role: 'ai', text: `[审计日志] 已完成本地脱敏，数据安全等级：L5。模型建议：根据《公司法》最新修正案，您提到的股东退出条款需补充估值调整机制。` }]);
    }, 800);
  };

  return (
    <div className="h-full flex animate-in slide-in-from-right-4">
      <div className="w-80 bg-white border-r p-6 flex flex-col space-y-6">
         <button onClick={onBack} className="text-xs text-blue-600 font-bold flex items-center mb-4 hover:underline"><ChevronRight size={14} className="rotate-180 mr-1" /> 返回模型广场</button>
         <div className="p-4 bg-slate-900 rounded-2xl space-y-4 shadow-xl">
            <div className="flex items-center text-blue-400 text-[10px] font-bold uppercase tracking-widest"><Terminal size={14} className="mr-2" /> 推理链路监控</div>
            <div className="font-mono text-[9px] text-slate-500 space-y-1">
               <p className="text-emerald-400">{"->"} 本地 NER 网关已隐藏敏感项</p>
               <p className="text-blue-400">{"->"} VPC SSL 专线传输中...</p>
               <p className="text-slate-400">{"<-"} 模型回传结果 (双向映射中)</p>
            </div>
         </div>
      </div>
      <div className="flex-1 flex flex-col bg-white">
         <div className="px-6 py-4 border-b flex items-center space-x-3">
            <div className="p-2 bg-slate-900 text-white rounded-xl"><Zap size={18} /></div>
            <div><h3 className="font-bold text-sm">{model.name} 调试沙盒</h3><p className="text-[10px] text-slate-500">隔离运行中</p></div>
         </div>
         <div className="flex-1 overflow-y-auto p-6 space-y-6">
            {messages.map((m, i) => (
               <div key={i} className={`flex ${m.role === 'ai' ? 'justify-start' : 'justify-end'}`}>
                  <div className={`max-w-[80%] p-4 rounded-2xl text-sm leading-relaxed ${m.role === 'ai' ? 'bg-slate-100 text-slate-800 rounded-tl-none border border-slate-200' : 'bg-slate-900 text-white rounded-tr-none'}`}>{m.text}</div>
               </div>
            ))}
         </div>
         <div className="p-6 border-t">
            <div className="relative">
              <textarea value={input} onChange={(e) => setInput(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && (e.preventDefault(), handleSend())} className="w-full bg-slate-50 border border-slate-200 rounded-2xl p-4 pr-12 text-sm outline-none focus:ring-2 focus:ring-blue-500 min-h-[100px] resize-none" placeholder="输入测试法律 Prompt..." />
              <button onClick={handleSend} className="absolute bottom-4 right-4 p-2 bg-blue-600 text-white rounded-xl shadow-lg hover:bg-blue-700 transition-colors"><Send size={18} /></button>
            </div>
         </div>
      </div>
    </div>
  );
};

// --- 应用中心组件 ---
const AppCenter = ({ onSelectAgent }) => {
  const apps = [
    { id: 'securities', title: '证券底稿核查 Agent', desc: '自动分类归档、一致性比对、风险红点巡检', icon: <FileCheck className="text-blue-600" />, category: '专家 Agent' },
    { id: 'translation', title: '高保真法律翻译', desc: '1:1 格式还原，支持中英俄法等多语种及版式保护', icon: <Languages className="text-purple-600" />, category: '通用工具' },
    { id: 'bidding', title: '智能投标制作', desc: '素材自动抓取、标书补足、响应性审查', icon: <FileSignature className="text-indigo-600" />, category: '业务助手' },
    { id: 'conflict', title: '利冲检索助手', desc: '穿透式股权关系识别，语义化分析利益冲突', icon: <Search className="text-amber-600" />, category: '风控工具' },
  ];

  return (
    <div className="p-8 space-y-8 animate-in slide-in-from-bottom-4">
      <div className="flex justify-between items-end">
        <div>
          <h2 className="text-2xl font-bold text-slate-800 italic">应用中心</h2>
          <p className="text-sm text-slate-500">已根据律所合规要求配置的智能生产力工具</p>
        </div>
      </div>
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {apps.map((app) => (
          <div 
            key={app.id} 
            onClick={() => onSelectAgent(app.id)}
            className="bg-white p-6 rounded-[32px] border border-slate-200 shadow-sm hover:shadow-xl hover:border-blue-300 transition-all cursor-pointer group"
          >
            <div className="flex justify-between items-start mb-4">
              <div className="w-12 h-12 bg-slate-50 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform">
                {app.icon}
              </div>
              <span className="text-[10px] font-bold bg-blue-50 text-blue-700 px-2 py-0.5 rounded uppercase tracking-widest italic">Stable</span>
            </div>
            <h3 className="font-bold text-slate-800 mb-2">{app.title}</h3>
            <p className="text-xs text-slate-500 leading-relaxed mb-6 line-clamp-2">{app.desc}</p>
            <div className="flex items-center justify-between pt-4 border-t border-slate-50">
              <span className="text-[10px] text-slate-400 bg-slate-100 px-2 py-0.5 rounded uppercase font-bold">{app.category}</span>
              <span className="text-blue-600 text-xs font-bold flex items-center group-hover:translate-x-1 transition-transform">立即启动 <ChevronRight size={14} /></span>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

// --- 工作台/Dashboard ---
const Dashboard = () => (
  <div className="p-8 space-y-8 animate-in fade-in">
    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div className="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
        <h3 className="text-slate-500 text-[10px] font-bold uppercase mb-2 tracking-widest">活跃模型状态</h3>
        <p className="text-3xl font-bold text-slate-900">Qwen-Max</p>
      </div>
      <div className="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
        <h3 className="text-slate-500 text-[10px] font-bold uppercase mb-2 tracking-widest">已完成脱敏数</h3>
        <p className="text-3xl font-bold text-indigo-600">12,842</p>
      </div>
      <div className="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm">
        <h3 className="text-slate-500 text-[10px] font-bold uppercase mb-2 tracking-widest">私有知识库规模</h3>
        <p className="text-3xl font-bold text-emerald-600">1.2M+</p>
      </div>
    </div>
    <div className="bg-slate-900 text-white p-10 rounded-[40px] shadow-2xl relative overflow-hidden">
       <div className="relative z-10 space-y-4">
          <h2 className="text-3xl font-bold italic">欢迎回来，王律师</h2>
          <p className="text-slate-400 text-sm max-w-md leading-relaxed">您的工作环境受本地私有化模型保护。所有发往云端的数据已由自有模型完成占位符双向映射，确保办案数据隐私不出网。</p>
          <button className="bg-blue-600 text-white px-8 py-3 rounded-2xl text-sm font-bold shadow-lg hover:bg-blue-700 transition-colors">快速发起合规审查</button>
       </div>
       <Cpu size={240} className="absolute -right-20 -bottom-20 text-blue-900/10 rotate-12 pointer-events-none" />
    </div>
  </div>
);

// --- 模型广场组件 ---
const ModelHub = ({ onSelectTest }) => {
  const models = [
    { id: 'local', name: '律所自有私有化模型', provider: '本地部署', type: '内网隔离', latency: '12ms', description: '处理核心脱敏、利冲检索及关系识别。', premium: true },
    { id: 'qwen', name: 'Qwen-Max (通义千问)', provider: 'Alibaba', type: '云端 (VPC)', latency: '42ms', description: '中文法律理解力顶尖，适用于长文档审核。' },
    { id: 'deepseek', name: 'DeepSeek-V3', provider: 'DeepSeek', type: '云端 (VPC)', latency: '35ms', description: '高性价比，适用于大批量文书预处理。' },
  ];
  return (
    <div className="p-8 grid grid-cols-1 md:grid-cols-3 gap-6 animate-in fade-in">
      {models.map((m, i) => (
        <div key={i} className={`bg-white border p-6 rounded-[32px] transition-all hover:shadow-xl ${m.id === 'local' ? 'border-indigo-200 ring-4 ring-indigo-50 shadow-indigo-100/50' : 'border-slate-200'}`}>
           <div className="flex justify-between items-start mb-6">
              <div className={`p-3 rounded-2xl ${m.id === 'local' ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-900'}`}>{m.id === 'local' ? <Server size={24} /> : <Zap size={24} />}</div>
              {m.premium && <span className="text-[10px] font-bold bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded uppercase italic">Private</span>}
           </div>
           <h4 className="font-bold text-slate-800 text-lg">{m.name}</h4>
           <p className="text-[10px] text-slate-400 mb-4 tracking-wider uppercase">{m.provider} · {m.type}</p>
           <p className="text-xs text-slate-500 leading-relaxed mb-8 h-12 overflow-hidden line-clamp-3">{m.description}</p>
           <button onClick={() => onSelectTest(m)} className="w-full py-3 bg-slate-900 text-white rounded-2xl text-xs font-bold hover:bg-slate-800 transition-colors">进入沙盒测试</button>
        </div>
      ))}
    </div>
  );
};

// --- 主程序入口 ---
export default function App() {
  const [activeTab, setActiveTab] = useState('workbench');
  const [activeAgent, setActiveAgent] = useState(null);
  const [testModel, setTestModel] = useState(null);

  const navigation = [
    { id: 'workbench', label: '工作台', icon: <LayoutDashboard size={20} /> },
    { id: 'appcenter', label: '应用中心', icon: <Grid size={20} /> },
    { id: 'modelhub', label: '模型广场', icon: <Cpu size={20} /> },
    { id: 'settings', label: '系统设置', icon: <Settings size={20} /> },
  ];

  const renderContent = () => {
    // 优先处理模型沙盒测试
    if (testModel) return <ModelSandbox model={testModel} onBack={() => setTestModel(null)} />;

    // 处理 Agent 路由
    if (activeAgent) {
      switch (activeAgent) {
        case 'securities': return <SecuritiesAgent />;
        case 'translation': return <LegalTranslation />;
        case 'bidding': return <BiddingAgent />;
        case 'conflict': return <ConflictSearch />;
        default: return <div className="p-8 text-center text-slate-400">Agent 加载中...</div>;
      }
    }

    // 处理主导航标签页
    switch (activeTab) {
      case 'workbench': return <Dashboard />;
      case 'appcenter': return <AppCenter onSelectAgent={(id) => setActiveAgent(id)} />;
      case 'modelhub': return <ModelHub onSelectTest={setTestModel} />;
      default: return (
        <div className="flex flex-col items-center justify-center h-full text-slate-400 space-y-4">
          <Database size={48} className="opacity-20" />
          <p className="text-sm">模块正在同步数据底座...</p>
        </div>
      );
    }
  };

  return (
    <div className="flex h-screen bg-slate-50 font-sans overflow-hidden text-slate-900">
      {/* 侧边导航 */}
      <aside className="w-64 bg-slate-900 flex flex-col shadow-2xl z-20">
        <div className="p-6 flex items-center space-x-3 border-b border-slate-800">
          <div className="w-8 h-8 bg-blue-600 rounded flex items-center justify-center text-white font-bold italic shadow-lg shadow-blue-500/20">AI</div>
          <h1 className="text-white font-bold text-lg tracking-tight italic">智能应用平台</h1>
        </div>
        <nav className="flex-1 p-4 space-y-2">
          {navigation.map((item) => (
            <button
              key={item.id}
              onClick={() => { setActiveTab(item.id); setActiveAgent(null); setTestModel(null); }}
              className={`w-full flex items-center space-x-3 px-4 py-3 rounded-2xl transition-all ${
                activeTab === item.id && !activeAgent && !testModel
                  ? 'bg-blue-600 text-white shadow-xl shadow-blue-900/40'
                  : 'text-slate-400 hover:bg-slate-800 hover:text-slate-200'
              }`}
            >
              {item.icon}
              <span className="font-medium text-sm">{item.label}</span>
            </button>
          ))}
        </nav>
        <div className="p-6 mt-auto">
          <div className="bg-slate-800/50 p-4 rounded-3xl flex items-center space-x-3">
             <div className="w-10 h-10 bg-indigo-100 rounded-2xl flex items-center justify-center text-indigo-700 font-bold">王</div>
             <div className="min-w-0">
                <p className="text-xs font-bold text-white truncate">王大明 律师</p>
                <p className="text-[10px] text-slate-500">证券业务合伙人</p>
             </div>
          </div>
        </div>
      </aside>

      {/* 主内容区域 */}
      <main className="flex-1 flex flex-col min-w-0">
        <SecurityHeader />
        <header className="bg-white px-6 py-4 flex items-center justify-between border-b border-slate-100 z-10 shadow-sm">
          <div className="flex items-center space-x-4">
            {(activeAgent || testModel) && (
              <button 
                onClick={() => { setActiveAgent(null); setTestModel(null); }} 
                className="p-2 hover:bg-slate-100 rounded-full transition text-slate-500"
              >
                <ChevronRight size={20} className="rotate-180" />
              </button>
            )}
            <h2 className="text-lg font-bold text-slate-800 italic">
              {testModel ? `${testModel.name} 调试沙盒` : 
               activeAgent === 'securities' ? '证券底稿核查 Agent' :
               activeAgent === 'translation' ? '高保真法律翻译' :
               activeAgent === 'bidding' ? '智能投标制作' :
               activeAgent === 'conflict' ? '利益冲突检索' :
               navigation.find(n => n.id === activeTab)?.label || '工作台'}
            </h2>
          </div>
          <div className="flex items-center space-x-4">
             <div className="relative">
                <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={14} />
                <input type="text" placeholder="搜索应用或文档..." className="pl-10 pr-4 py-2 bg-slate-100 border-none rounded-xl text-[10px] w-48 focus:ring-2 focus:ring-blue-500/20 outline-none" />
             </div>
             <button className="p-2 text-slate-400 hover:bg-slate-100 rounded-full relative">
                <Bell size={18} />
                <span className="absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
             </button>
          </div>
        </header>

        <div className="flex-1 overflow-auto">
          {renderContent()}
        </div>
      </main>
    </div>
  );
}