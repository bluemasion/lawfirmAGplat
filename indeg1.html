import React, { useState, useEffect, useRef } from 'react';
import {
ShieldCheck, LayoutDashboard, Grid, Cpu, Settings, Search, Bell, User, ChevronRight, FileText,
Languages, Gavel, FileCheck, Activity, AlertCircle, CheckCircle2, Clock, Upload, Send,
FolderOpen, FileSignature, Filter, ArrowRightLeft, Download, FileSearch, BookOpen, Type,
Maximize2, Users, Briefcase, CheckSquare, SearchCode, FileDown, ArrowRight, Zap, BarChart3,
Globe, Lock, RefreshCw, MoreVertical, Sliders, Terminal, Code2, History, Info, UserPlus,
Link2, Eye, FileWarning, Database, Server, Network, Key, CreditCard, Share2, ExternalLink,
ChevronDown, MoreHorizontal, HardDrive, Users2, Layers, Box, MessageSquare, X, Command, Sparkles,
ToggleRight, EyeOff, Edit3, Plus, Trash2, Shield
} from 'lucide-react';

/**
* --------------------------------------------------------------------------------
* 1. 基础控制台原子组件 (Enterprise UI Kit)
* --------------------------------------------------------------------------------
*/

const MetricCard = ({ label, value, trend, unit }) => (
<div className="bg-white border border-zinc-200 p-4 rounded-sm shadow-sm hover:shadow-md transition-all group">
    <div className="flex justify-between items-start mb-2">
        <span className="text-zinc-500 text-[10px] font-bold uppercase tracking-widest">{label}</span>
        <MoreHorizontal size={14}
            className="text-zinc-400 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer" />
    </div>
    <div className="flex items-baseline space-x-1">
        <span className="text-2xl font-bold text-zinc-900 tracking-tight">{value}</span>
        {unit && <span className="text-xs text-zinc-400 font-bold">{unit}</span>}
    </div>
    {trend && (
    <div className="mt-2 flex items-center text-[10px] font-bold">
        <span className={trend.startsWith('+') ? 'text-emerald-600' : 'text-rose-600' }>{trend}</span>
        <span className="text-zinc-400 ml-1 font-medium text-[9px]">较昨日</span>
    </div>
    )}
</div>
);

const GlobalHeader = ({ onReset }) => (
<div className="bg-[#151921] text-white h-12 flex items-center justify-between px-4 z-50 shadow-md shrink-0">
    <div className="flex items-center space-x-6">
        <div className="flex items-center space-x-2 cursor-pointer group" onClick={onReset}>
            <div
                className="w-6 h-6 bg-orange-500 rounded-sm flex items-center justify-center font-bold text-xs italic text-white shadow-sm">
                L</div>
            <span
                className="font-bold text-sm tracking-tight uppercase group-hover:text-orange-400 transition-colors">律所
                AI 控制台</span>
        </div>
        <div className="h-6 w-px bg-zinc-700"></div>
        <div className="flex items-center space-x-1 text-zinc-400 text-xs hover:text-white cursor-pointer transition">
            <Grid size={14} />
            <span>应用中心</span>
            <ChevronDown size={14} />
        </div>
    </div>
    <div className="flex-1 max-w-2xl px-8">
        <div className="relative group">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-zinc-500" size={14} />
            <input type="text" placeholder="搜索 Agent、案卷或安全审计日志..."
                className="w-full bg-[#2a3139] border-zinc-700 border text-[11px] py-1.5 pl-10 pr-4 rounded focus:outline-none focus:border-orange-500 transition-colors placeholder:text-zinc-600 font-medium" />
        </div>
    </div>
    <div className="flex items-center space-x-5">
        <div
            className="flex items-center space-x-1 text-emerald-500 text-[10px] font-bold border border-emerald-900/30 bg-emerald-950/20 px-2 py-1 rounded-sm uppercase tracking-tighter">
            <ShieldCheck size={14} />
            <span className="hidden lg:inline">VPC 已加密连接</span>
        </div>
        <div
            className="flex items-center space-x-2 bg-zinc-800 px-3 py-1 rounded-sm cursor-pointer border border-zinc-700 hover:bg-zinc-700 transition shadow-sm">
            <div
                className="w-5 h-5 bg-blue-600 rounded-full flex items-center justify-center text-[10px] font-bold text-white uppercase italic">
                W</div>
            <span className="text-xs font-bold whitespace-nowrap">王大明 @ 天元律所</span>
            <ChevronDown size={12} className="text-zinc-500" />
        </div>
    </div>
</div>
);

/**
* --------------------------------------------------------------------------------
* 2. 核心业务 Agent 组件 (Securities, Translation, Conflict, Bidding)
* --------------------------------------------------------------------------------
*/

// A. 证券底稿核查
const SecuritiesAgent = () => (
<div className="h-full flex overflow-hidden bg-white animate-in fade-in">
    <div className="w-64 bg-[#f8f9fa] border-r border-zinc-200 flex flex-col p-4 space-y-6 shrink-0">
        <div className="space-y-1">
            <h4 className="text-[10px] font-bold text-zinc-400 uppercase tracking-widest px-2 mb-2">项目结构</h4>
            <div
                className="flex items-center space-x-2 p-2 bg-white rounded-sm border border-zinc-300 text-[11px] font-bold text-zinc-800 shadow-sm">
                <FolderOpen size={14} className="text-orange-500" />
                <span className="truncate">天元 IPO 环保专项底稿</span>
            </div>
        </div>
        <div className="space-y-1 overflow-y-auto">
            <h4 className="text-[10px] font-bold text-zinc-400 uppercase tracking-widest px-2 mb-2 font-mono">
                FILE_NAVIGATOR</h4>
            {['01-核查说明.docx', '02-访谈记录.pdf', '03-政府官网截图.png'].map((f, i) => (
            <div key={i}
                className="flex items-center space-x-2 p-2 rounded-sm hover:bg-zinc-200 transition text-[11px] cursor-pointer font-bold text-zinc-600">
                <FileText size={12} className="text-zinc-400" />
                <span className="truncate">{f}</span>
            </div>
            ))}
        </div>
    </div>
    <div className="flex-1 flex flex-col">
        <div className="h-12 border-b border-zinc-200 flex items-center justify-between px-6 bg-white shrink-0">
            <div className="flex items-center space-x-2 text-[11px] font-bold"><span className="text-zinc-400">应用</span>
                <ChevronRight size={12} /> <span className="text-zinc-800 font-bold">证券核查控制台</span>
            </div>
            <button
                className="bg-blue-600 text-white px-3 py-1 rounded-sm text-[10px] font-bold hover:bg-blue-700 transition shadow-sm uppercase tracking-widest">Deploy
                Full Audit</button>
        </div>
        <div className="flex-1 overflow-y-auto bg-zinc-100/50 p-6 space-y-4">
            <div
                className="bg-[#1a1c23] border border-zinc-700 rounded-sm p-4 text-[11px] font-mono shadow-xl text-zinc-400 space-y-2">
                <p className="text-emerald-500 font-bold mb-2">/LOCAL_NER_GATEWAY/ 正在拦截流量并生成占位映射...</p>
                <p><span className="text-zinc-600">[22:45:01]</span> 发现敏感实体：[张三] {'->'} [PERSON_01]</p>
                <p className="text-blue-400 font-bold border-t border-zinc-800 pt-2 mt-2">[VPC_SSL] 已加密发送至私有算力实例 i-8821
                </p>
            </div>
            <div className="bg-white border-l-4 border-orange-500 p-5 shadow-sm rounded-sm">
                <h5 className="text-xs font-bold text-orange-600 mb-2 flex items-center">
                    <AlertCircle size={14} className="mr-1" /> AI 一致性异常预警
                </h5>
                <p className="text-[11px] text-zinc-700 leading-relaxed font-bold">底稿中 2024
                    年的环保罚金记录（505.2万）与意见书“无重大处罚”的描述存在冲突。</p>
            </div>
        </div>
    </div>
</div>
);

// B. 高保真法律翻译
const LegalTranslation = () => (
<div className="h-full flex flex-col bg-zinc-100 overflow-hidden animate-in fade-in">
    <div className="h-12 border-b border-zinc-200 bg-white flex items-center justify-between px-6 shrink-0 shadow-sm">
        <div className="flex items-center space-x-4 text-[11px] font-bold uppercase tracking-tight">
            <div className="bg-zinc-100 px-3 py-1 rounded-sm border border-zinc-200 text-zinc-700">ZH {'->'} EN</div>
            <span
                className="text-purple-600 flex items-center bg-purple-50 px-2 py-1 border border-purple-100 rounded-sm font-mono">
                <Zap size={14} className="mr-1" /> Layout-Engine: Active
            </span>
        </div>
        <button
            className="bg-purple-600 text-white px-4 py-1.5 rounded-sm text-[10px] font-bold hover:bg-purple-700 uppercase tracking-tighter shadow-md">Export
            Mirrored Doc</button>
    </div>
    <div className="flex-1 flex p-6 space-x-6 overflow-hidden">
        <div
            className="flex-1 bg-white border border-zinc-200 p-10 overflow-y-auto opacity-30 shadow-sm rounded-sm font-serif text-sm leading-loose">
            <h4 className="text-center text-lg font-bold mb-10">项目资产转让协议</h4>
            <p className="font-bold underline">第一条：定义与解释</p>
            <p>“关联方”指对任何一方而言，直接或间接控制该方、受该方控制或与该方共同受控制的任何实体。</p>
        </div>
        <div
            className="flex-1 bg-white border border-purple-200 p-10 overflow-y-auto shadow-2xl relative rounded-sm font-serif text-sm leading-loose text-zinc-900 ring-4 ring-purple-50">
            <div
                className="absolute top-0 right-0 p-2 bg-purple-600 text-white text-[9px] font-bold tracking-widest uppercase">
                Mirror Rendering</div>
            <h4 className="text-center text-lg font-bold mb-10 tracking-tight">Asset Transfer Agreement</h4>
            <p
                className="font-bold underline decoration-purple-400 underline-offset-4 uppercase font-mono text-xs mb-4">
                Article 1: Definitions</p>
            <p>"<span className="bg-amber-100 px-1 rounded font-bold border-b border-amber-300">Related Party</span>"
                means, with respect to any party, any entity that directly or indirectly controls, is controlled by, or
                is under common control with such party.</p>
            <div
                className="w-full h-40 border border-dashed border-zinc-200 rounded flex flex-col items-center justify-center text-zinc-300 space-y-2 italic mt-16 shadow-inner bg-zinc-50/50">
                <ShieldCheck size={24} /><span className="text-[10px] font-bold uppercase tracking-widest">物理印章版式指纹已 1:1
                    还原</span>
            </div>
        </div>
    </div>
</div>
);

// C. 智能投标制作 (FIXED: Full Interaction)
const BiddingAgent = () => {
const [step, setStep] = useState(3);
return (
<div className="h-full flex flex-col bg-white overflow-hidden animate-in slide-in-from-bottom-2">
    <div className="h-14 border-b border-zinc-200 px-8 flex items-center bg-zinc-50 space-x-12 shrink-0">
        <h2 className="text-xs font-bold text-zinc-800 border-r border-zinc-300 pr-8 uppercase tracking-widest">投标制作控制台
            / Bidding Studio</h2>
        <div className="flex items-center space-x-10">
            {['素材自动抓取', '模版智能填充', '合规性实时审计'].map((label, i) => (
            <div key={i} className={`text-[11px] font-bold flex items-center space-x-2 ${step> i ? 'text-blue-600' :
                'text-zinc-400'}`}>
                <div className={`w-5 h-5 rounded-full flex items-center justify-center border ${step> i ? 'bg-blue-600
                    text-white border-blue-600 shadow-sm' : 'bg-white border-zinc-300'}`}>
                    {step > i + 1 ?
                    <CheckCircle2 size={12} /> : i + 1}
                </div>
                <span>{label}</span>
            </div>
            ))}
        </div>
    </div>
    <div className="flex-1 flex overflow-hidden">
        <div className="flex-1 bg-zinc-100 p-8 overflow-y-auto shadow-inner">
            <div
                className="bg-white max-w-2xl mx-auto shadow-2xl p-12 min-h-[800px] border border-zinc-300 font-serif rounded-sm">
                <h3
                    className="text-xl font-bold text-center underline underline-offset-8 decoration-zinc-200 mb-12 uppercase tracking-tight">
                    投标文件 (Draft)</h3>
                <div className="space-y-8 text-[13px] text-zinc-800 leading-relaxed">
                    <div className="p-4 bg-blue-50 border-l-4 border-blue-500 italic text-blue-800 font-medium text-xs">
                        [AI 实时适配] 识别到招标文件对“跨境争议解决”有特别加分项，已自动抓取本所 2024 年新加坡办公室的 2 个标杆案例。
                    </div>
                    <p className="font-bold">第一部分：服务团队优势</p>
                    <p>本所委派以 <b>王大明</b> 律师为核心的专家组。该团队在 2024 年成功承办了多项具有国际影响力的 IPO 法律服务项目...</p>
                    <div
                        className="w-full h-32 border border-zinc-100 rounded-sm bg-zinc-50 flex flex-col items-center justify-center text-zinc-300 space-y-2 font-mono">
                        <Database size={20} /><span
                            className="text-[10px] uppercase font-bold tracking-widest">案管系统实体数据自动注入区</span>
                    </div>
                </div>
            </div>
        </div>
        <div
            className="w-[340px] border-l border-zinc-200 bg-white p-6 space-y-6 overflow-y-auto shrink-0 shadow-inner">
            <h4
                className="text-[10px] font-bold text-zinc-400 uppercase tracking-widest flex items-center border-b border-zinc-100 pb-3">
                <SearchCode size={14} className="mr-2" /> 智能审核反馈 (实时)
            </h4>
            <div className="bg-emerald-50 p-4 border border-emerald-100 rounded-sm shadow-sm">
                <p className="text-[11px] font-bold text-emerald-800 flex items-center mb-1">
                    <CheckSquare size={14} className="mr-1" /> 强制响应项：100%
                </p>
                <p className="text-[10px] text-emerald-600 font-medium leading-relaxed">经 AI 逻辑比对，投标文件已精准覆盖招标文件要求的 12
                    项服务范围。</p>
            </div>
            <div className="bg-amber-50 p-4 border border-amber-100 rounded-sm shadow-sm">
                <p className="text-[11px] font-bold text-amber-800 flex items-center mb-1">
                    <FileWarning size={14} className="mr-1" /> 规范性词汇预警 (2)
                </p>
                <p className="text-[10px] text-amber-700 italic font-medium">检测到“本所实力全国第一”等绝对化用语。建议修改为“本所多次入围 Chambers
                    第一梯队”。</p>
                <button className="mt-2 text-[9px] font-bold text-amber-900 underline">一键应用优化建议</button>
            </div>
            <div className="pt-6 border-t border-zinc-100">
                <button
                    className="w-full py-3 bg-[#151921] text-white rounded-sm font-bold text-xs shadow-lg hover:bg-black transition-all uppercase tracking-widest">
                    生成并导出正式标书 (.docx)
                </button>
                <p className="text-[9px] text-zinc-400 mt-4 text-center italic font-bold">导出文件将严格保持律所视觉识别系统 (VI) 标准</p>
            </div>
        </div>
    </div>
</div>
);
};

// D. 利益冲突检索
const ConflictSearch = () => {
const [isSearching, setIsSearching] = useState(false);
const [result, setResult] = useState(null);
const handleSearch = () => {
setIsSearching(true);
setTimeout(() => {
setResult({ risk: 'HIGH', matches: [{ name: '腾讯控股', relation: '母公司', status: '历史在办' }, { name: '腾讯科技', relation: '子公司',
status: '当前顾问' }] });
setIsSearching(false);
}, 1200);
};
return (
<div className="h-full bg-white p-10 animate-in fade-in overflow-y-auto">
    <div className="max-w-4xl mx-auto space-y-10">
        <div className="space-y-1 border-b border-zinc-200 pb-6">
            <h2 className="text-xl font-bold text-zinc-900 tracking-tight uppercase">利冲排查控制台 / Conflict Search</h2>
        </div>
        <div className="flex space-x-3">
            <div className="relative flex-1 group">
                <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-zinc-400" size={18} />
                <input type="text" defaultValue="腾讯控股有限公司"
                    className="w-full pl-12 pr-4 py-4 bg-zinc-50 border-2 border-zinc-200 rounded-sm focus:border-blue-600 outline-none text-md font-bold" />
            </div>
            <button onClick={handleSearch}
                className="bg-[#232f3e] text-white px-10 rounded-sm font-bold text-[11px] hover:bg-black transition-all flex items-center shadow-lg uppercase tracking-widest">
                {isSearching ?
                <RefreshCw className="animate-spin mr-2" size={14} /> :
                <ShieldCheck className="mr-2 text-emerald-500" size={14} />}
                执行扫描
            </button>
        </div>
        {result && (
        <div className="animate-in slide-in-from-bottom-4 space-y-6 pb-20">
            <div
                className="p-6 bg-rose-50 border-2 border-rose-200 rounded-sm flex items-center justify-between shadow-md">
                <div className="flex items-center space-x-5 text-rose-600">
                    <FileWarning size={32} />
                    <div>
                        <h4 className="text-lg font-bold text-rose-900">冲突风险：HIGH RISK</h4>
                        <p
                            className="text-[11px] font-bold italic opacity-80 underline underline-offset-4 decoration-rose-200">
                            发现 2 个穿透式关联方涉及本所当前业务利益对立。</p>
                    </div>
                </div>
            </div>
            <div className="grid grid-cols-2 gap-6">
                <div className="bg-white border border-zinc-200 p-6 rounded-sm space-y-4">
                    <h5
                        className="text-[10px] font-bold text-zinc-400 uppercase tracking-widest flex items-center mb-4">
                        <Link2 size={14} className="mr-2" /> 语义关联图谱
                    </h5>
                    {result.matches.map((m, i) => (
                    <div key={i}
                        className="flex justify-between items-center text-[11px] font-bold text-zinc-700 border-b border-zinc-50 pb-2">
                        <span>{m.name}</span><span
                            className="text-[9px] bg-blue-50 text-blue-700 px-1.5 py-0.5 rounded border border-blue-100 uppercase">{m.relation}</span>
                    </div>
                    ))}
                </div>
                <div
                    className="bg-[#151921] border border-zinc-800 p-6 rounded-sm shadow-2xl relative overflow-hidden font-mono text-[10px] text-emerald-500/80">
                    <h5 className="text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-6 relative z-10">
                        Local Inference Fingerprint</h5>
                    <p className="relative z-10">[{new Date().toLocaleTimeString()}] Triggering Parent-Child
                        algorithm...</p>
                    <p
                        className="relative z-10 text-emerald-400 font-bold border-t border-emerald-900/30 pt-4 mt-4 uppercase tracking-widest">
                        Risk Score: 0.94 (命中强制回避)</p>
                    <Network size={140} className="absolute -right-12 -bottom-12 text-emerald-500/5 rotate-12" />
                </div>
            </div>
        </div>
        )}
    </div>
</div>
);
};

/**
* --------------------------------------------------------------------------------
* 3. 平台管理与设置 (Resource Monitor + NER Configuration)
* --------------------------------------------------------------------------------
*/

const SettingsPage = () => {
const [activeSub, setActiveSub] = useState('resource');
const [nerRules, setNerRules] = useState([
{ id: 'per', label: '人名脱敏 (Identity)', enabled: true },
{ id: 'org', label: '机构名称 (Institution)', enabled: true },
{ id: 'amt', label: '合同金额 (Financial)', enabled: true },
{ id: 'case', label: '法院案号 (CaseID)', enabled: false },
]);
const [testText, setTestText] = useState('经查，张三在深圳市腾讯计算机系统有限公司任职，曾支付500万元。');

const getMaskedText = () => {
let text = testText;
if (nerRules.find(r => r.id === 'per')?.enabled) text = text.replace(/张三/g, '[姓名_ID1]');
if (nerRules.find(r => r.id === 'org')?.enabled) text = text.replace(/深圳市腾讯计算机系统有限公司/g, '[机构_ID_A]');
if (nerRules.find(r => r.id === 'amt')?.enabled) text = text.replace(/500万元/g, '[金额_MASKED]');
return text;
};

const resourceMetrics = [
{ label: 'GPU (Tesla T4)', usage: 42, icon:
<Zap size={18} />, color: 'emerald' },
{ label: 'CPU (32-Core)', usage: 18, icon:
<Cpu size={18} />, color: 'blue' },
{ label: '内存 (ECC RAM)', usage: 25, icon:
<Layers size={18} />, color: 'amber' },
{ label: '存储 (NVMe SSD)', usage: 64, icon:
<HardDrive size={18} />, color: 'rose' }
];

return (
<div className="h-full flex flex-col bg-white animate-in fade-in">
    <div className="h-14 border-b border-zinc-200 flex items-center px-8 space-x-10 bg-zinc-50 shrink-0 shadow-sm">
        <div className="flex items-center space-x-3">
            <Settings className="text-zinc-600" size={20} />
            <h2 className="text-sm font-bold text-zinc-800 uppercase tracking-widest font-sans">平台治理中心 / Platform Admin
            </h2>
        </div>
        <div className="h-full flex">
            {[{id:'resource', label:'算力资源监控'}, {id:'security', label:'脱敏策略交互'}].map(tab => (
            <button key={tab.id} onClick={()=> setActiveSub(tab.id)} className={`px-5 h-full text-[10px] font-bold
                transition-all relative uppercase tracking-widest ${activeSub === tab.id ? 'text-blue-600' :
                'text-zinc-400 hover:text-zinc-800'}`}>{tab.label}{activeSub === tab.id && <div
                    className="absolute bottom-0 left-0 right-0 h-[3px] bg-blue-600 animate-in slide-in-from-left-full">
                </div>}</button>
            ))}
        </div>
    </div>
    <div className="flex-1 p-8 overflow-y-auto w-full">
        <div className="max-w-6xl mx-auto space-y-12">
            {activeSub === 'resource' && (
            <div className="space-y-10 animate-in slide-in-from-right-2">
                <div className="grid grid-cols-4 gap-4">
                    {resourceMetrics.map((res, i) => (
                    <div key={i}
                        className="bg-white border border-zinc-200 p-5 rounded-sm shadow-sm space-y-4 hover:border-blue-400 transition-all">
                        <div
                            className="flex justify-between items-center text-zinc-400 group-hover:text-blue-600 transition-colors">
                            {res.icon}<span
                                className="text-[9px] font-bold uppercase tracking-widest">{res.label}</span></div>
                        <div className="space-y-2">
                            <div className="flex justify-between items-baseline"><span
                                    className="text-2xl font-bold text-zinc-900 tracking-tight">{res.usage}%</span><span
                                    className="text-[9px] text-zinc-400 font-mono italic">Operational</span></div>
                            <div className="w-full bg-zinc-100 h-1 rounded-full overflow-hidden">
                                <div className={`h-full bg-${res.color}-500 transition-all duration-1000`} style={{
                                    width: `${res.usage}%` }}></div>
                            </div>
                        </div>
                    </div>
                    ))}
                </div>
                <div className="bg-white border border-zinc-200 rounded-sm shadow-sm overflow-hidden">
                    <div
                        className="px-6 py-4 bg-zinc-50 border-b border-zinc-100 font-bold text-[10px] text-zinc-500 uppercase tracking-widest flex items-center">
                        <Users2 size={16} className="mr-2 text-blue-600" /> 实时在线会话审计
                    </div>
                    <table className="w-full text-left text-[11px] font-bold text-zinc-700">
                        <tbody className="divide-y divide-zinc-100 font-sans">
                            {['王大明 (证券合伙人)', '李晓云 (资深律师)', '张小杰 (法律助理)'].map((u, i) => (
                            <tr key={i} className="hover:bg-zinc-50 transition-colors">
                                <td className="px-6 py-3 flex items-center space-x-3">
                                    <div
                                        className="w-7 h-7 bg-zinc-800 rounded-full text-white flex items-center justify-center text-[10px] font-serif italic shadow-sm">
                                        {u[0]}</div><span>{u}</span>
                                </td>
                                <td className="px-6 py-3"><span
                                        className="px-2 py-0.5 bg-emerald-50 text-emerald-700 rounded-sm border border-emerald-100 text-[9px] uppercase tracking-tighter">Active:
                                        {i === 0 ? '底稿一致性扫描' : i === 1 ? '高保真翻译导出' : '利冲排查任务'}</span></td>
                                <td className="px-6 py-3 font-mono text-zinc-400 italic">22:15:32-UTC</td>
                            </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
            )}
            {activeSub === 'security' && (
            <div className="grid grid-cols-1 lg:grid-cols-12 gap-10 animate-in slide-in-from-right-2 duration-500">
                <div className="lg:col-span-7 space-y-6">
                    <h3 className="text-sm font-bold text-zinc-900 uppercase tracking-tighter border-b pb-2">本地脱敏网关核心规则
                        (NER Policies)</h3>
                    <div className="bg-white border border-zinc-200 rounded-sm shadow-sm divide-y">
                        {nerRules.map((rule, i) => (
                        <div key={i} className={`p-5 flex items-center justify-between transition-all ${rule.enabled
                            ? 'bg-white' : 'bg-zinc-50 opacity-60' }`}>
                            <div>
                                <div className="flex items-center space-x-3 font-sans"><span className={`text-xs
                                        font-bold ${rule.enabled ? 'text-zinc-800' : 'text-zinc-400'
                                        }`}>{rule.label}</span>{rule.enabled && <span
                                        className="text-[9px] bg-emerald-50 text-emerald-700 px-1.5 py-0.5 rounded border border-emerald-100 font-mono font-bold uppercase tracking-widest">ACTIVE</span>}
                                </div>
                                <p className="text-[10px] text-zinc-400 mt-1 font-medium italic font-sans">
                                    所有的实体识别与字符替换逻辑均 100% 运行于律所内网服务器。</p>
                            </div>
                            <button onClick={()=> { const nr = [...nerRules]; nr[i].enabled = !nr[i].enabled;
                                setNerRules(nr); }} className={`w-10 h-5 rounded-full relative transition-colors
                                ${rule.enabled ? 'bg-blue-600' : 'bg-zinc-300'}`}><div className={`absolute top-1 w-3
                                    h-3 bg-white rounded-full shadow-sm transition-all ${rule.enabled ? 'right-1'
                                    : 'left-1' }`}></div></button>
                        </div>
                        ))}
                    </div>
                </div>
                <div className="lg:col-span-5">
                    <div
                        className="bg-[#151921] rounded-sm shadow-2xl border border-zinc-800 h-full flex flex-col font-mono min-h-[450px]">
                        <div
                            className="px-4 py-3 bg-[#1c222d] border-b border-zinc-800 flex justify-between items-center">
                            <div
                                className="flex items-center space-x-2 text-white font-bold text-[10px] uppercase tracking-widest">
                                <Zap size={14} className="text-orange-500" /><span>Secure Sandbox Preview</span>
                            </div>
                            <div className="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
                        </div>
                        <div className="flex-1 p-6 space-y-8 overflow-y-auto">
                            <div className="space-y-3"><label
                                    className="text-[9px] font-bold text-zinc-500 uppercase tracking-widest border-b border-zinc-800 pb-1 flex justify-between"><span>原始文书输入</span><span
                                        className="text-zinc-700">RAW_INPUT</span></label><textarea value={testText}
                                    onChange={(e)=> setTestText(e.target.value)} className="w-full bg-zinc-900 border border-zinc-800 rounded-sm p-4 text-[11px] text-zinc-300 focus:outline-none focus:border-blue-600 h-28 resize-none leading-relaxed shadow-inner" /></div><div className="space-y-3 flex-1 flex flex-col"><label className="text-[9px] font-bold text-zinc-500 uppercase tracking-widest border-b border-zinc-800 pb-1 flex items-center"><ShieldCheck size={12} className="mr-1 text-emerald-500" /><span>脱敏指纹输出</span><span className="ml-auto text-zinc-700">MASKED_RESULT</span></label><div className="flex-1 w-full bg-black/40 border border-emerald-900/30 rounded-sm p-5 text-[11px] text-emerald-400/90 leading-relaxed italic shadow-inner overflow-y-auto">{getMaskedText()}</div></div></div></div></div>
             </div>
           )}
         </div>
      </div>
    </div>
  );
};

/**
 * --------------------------------------------------------------------------------
 * 4. 核心架构逻辑 (App Entry & Router)
 * --------------------------------------------------------------------------------
 */

export default function App() {
  const [activeTab, setActiveTab] = useState('workbench');
  const [activeAgent, setActiveAgent] = useState(null);
  const [testModel, setTestModel] = useState(null);

  const navigation = [
    { id: 'workbench', label: '控制台首页', icon: <LayoutDashboard size={18} /> },
    { id: 'appcenter', label: '应用中心', icon: <Grid size={18} /> },
    { id: 'modelhub', label: '算力实例', icon: <Cpu size={18} /> },
    { id: 'settings', label: '平台管理', icon: <Settings size={18} /> },
  ];

  const handleReset = () => { setActiveTab('workbench'); setActiveAgent(null); setTestModel(null); };

  const renderContent = () => {
    // 1. 模型控制台终端 (Console Terminal)
    if (testModel) return (
      <div className="h-full flex items-center justify-center bg-[#0a0a0a] text-emerald-500 font-mono text-[11px] p-12">
        <div className="space-y-6 max-w-xl w-full bg-black/40 p-10 border border-emerald-900/40 rounded-sm shadow-2xl animate-in zoom-in-95">
           <div className="flex items-center justify-between border-b border-emerald-900/20 pb-4"><p className="flex items-center animate-pulse uppercase font-bold text-emerald-400"><Zap size={14} className="mr-2"/> Establishing Connection to {testModel.name}...</p><div className="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,1)]"></div></div>
           <div className="space-y-2 opacity-80 uppercase tracking-tighter font-bold text-zinc-600"><p>[AUTH] Requesting VPC Token... <span className="text-emerald-700">OK</span></p><p>[SEC] Mounting Local NER Middleware... <span className="text-emerald-700">OK</span></p><p>[VPC] SSL-Tunnel AES-256 Activated...</p></div>
           <p className="text-emerald-400/90 leading-relaxed font-bold border-t border-emerald-900/20 pt-6 mt-6 uppercase tracking-wider italic">终端已就绪。所有数据传输严格遵守本所 L5 级别脱敏策略。请开始键入测试指令。</p>
           <div className="pt-8 flex justify-between border-t border-zinc-900"><button onClick={() => setTestModel(null)} className="text-zinc-700 hover:text-white transition uppercase font-bold tracking-widest text-[10px] underline underline-offset-4 decoration-rose-500 decoration-2">Terminate terminal session</button><div className="text-zinc-800 uppercase font-bold tracking-widest text-[10px]">Secure Context: ACTIVE</div></div>
        </div>
      </div>
    );

    // 2. 核心业务 Agent 路由 (Full Interaction)
    if (activeAgent) {
      switch (activeAgent) {
        case 'securities': return <SecuritiesAgent />;
        case 'translation': return <LegalTranslation />;
        case 'conflict': return <ConflictSearch />;
        case 'bidding': return <BiddingAgent />;
        default: return null;
      }
    }

    // 3. 顶级导航页
    switch (activeTab) {
      case 'workbench': return (
        <div className="p-6 space-y-8 animate-in fade-in">
          <div className="flex items-center justify-between border-b border-zinc-200 pb-4">
            <div className="flex items-center space-x-3"><LayoutDashboard className="text-blue-600" size={24} /><h1 className="text-lg font-bold text-zinc-800 tracking-tight uppercase tracking-tighter font-sans">律所控制台首页 / Console Dashboard</h1></div>
            <div className="px-3 py-1.5 bg-zinc-50 border border-zinc-300 rounded-sm text-[10px] font-bold text-zinc-500 uppercase tracking-widest font-mono">Region: Asia-SZ-01 (LAN_DEDICATED)</div>
          </div>
          <div className="grid grid-cols-4 gap-4">
            <MetricCard label="活跃算力节点" value="3 Nodes" trend="+2 nodes" />
            <MetricCard label="Token 累计流量" value="1,284" unit="k" trend="+14.2%" />
            <MetricCard label="本地脱敏调用" value="12,842" trend="+826" />
            <MetricCard label="平均检索延时" value="0.42" unit="sec" trend="-0.05s" />
          </div>
          <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div className="lg:col-span-8 bg-white border border-zinc-200 rounded-sm shadow-sm overflow-hidden flex flex-col min-h-[380px]">
               <div className="px-4 py-3 bg-[#f8f9fa] border-b border-zinc-200 flex justify-between items-center font-bold text-zinc-500 text-[10px] uppercase tracking-widest shadow-inner"><span>算力利用率实时监控 (Resource Utilization)</span><span className="text-emerald-600 flex items-center animate-pulse"><div className="w-1.5 h-1.5 bg-emerald-500 rounded-full mr-1"></div> Link Active</span></div>
               <div className="flex-1 p-10 h-full flex items-end space-x-2 bg-white">{[40, 60, 45, 90, 85, 70, 65, 50, 45, 80, 75, 95].map((h, i) => (<div key={i} className="flex-1 bg-blue-100 hover:bg-blue-600 transition-all rounded-t-sm group relative"><div className="absolute -top-6 left-1/2 -translate-x-1/2 bg-zinc-900 text-white text-[9px] px-1 rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap font-bold z-20">{h}% Load</div><div style={{ height: `${h}%` }} className="w-full bg-inherit rounded-t-sm" /></div>))}</div>
            </div>
            <div className="lg:col-span-4 space-y-6 flex flex-col">
               <div className="bg-[#151921] rounded-sm p-6 text-white shadow-2xl relative overflow-hidden border border-zinc-800 group h-full flex flex-col justify-between transition-all hover:border-emerald-900/50">
                  <div className="relative z-10 space-y-4"><h3 className="text-sm font-bold flex items-center border-b border-zinc-800 pb-4 uppercase tracking-tighter"><ShieldCheck size={18} className="text-emerald-500 mr-2" /> Security Compliance</h3><p className="text-[11px] text-zinc-400 leading-relaxed font-bold italic mt-4 font-sans">当前环境 100% 物理隔离。本地 NER 引擎识别正常。数据链路经 AES-256 加密映射，办案敏感信息不落地。</p></div>
                  <div className="relative z-10 pt-8 border-t border-zinc-800"><div className="flex justify-between text-[9px] uppercase font-bold text-zinc-500 tracking-widest mb-1"><span>Security Level</span><span className="text-emerald-400 font-mono">L5 - Highest</span></div><div className="w-full bg-zinc-800 h-1.5 rounded-full overflow-hidden mt-1 shadow-inner"><div className="bg-emerald-500 h-full w-full shadow-[0_0_8px_rgba(16,185,129,0.5)] animate-pulse"></div></div></div>
                  <Database size={160} className="absolute -right-16 -bottom-16 text-white/5 rotate-12 transition-opacity pointer-events-none" />
               </div>
            </div>
          </div>
        </div>
      );
      case 'appcenter': return (
        <div className="p-8 space-y-8 animate-in fade-in">
          <div className="border-b border-zinc-200 pb-4 flex justify-between items-end">
            <div><h2 className="text-xl font-bold text-zinc-800 uppercase tracking-tighter italic font-sans">应用中心 / APP DIRECTORY</h2><p className="text-[10px] text-zinc-400 font-bold uppercase tracking-widest mt-1 font-mono">Select Service to Launch Dedicated Console</p></div>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 pb-20">
            {[
              { id: 'securities', title: '证券底稿核查', desc: '企业级 IPO 底稿多维比对、风险扫描及自动归档。', icon: <FileCheck /> },
              { id: 'translation', title: '法律高保真翻译', desc: '1:1 格式还原翻译，支持印章排版对齐。', icon: <Languages /> },
              { id: 'conflict', title: '利冲检索助手', desc: '基于私有化模型，实现穿透式语义识别。', icon: <Search /> },
              { id: 'bidding', title: '智能投标制作', desc: '自动抓取案管数据及律师履历，智能补全标书。', icon: <FileSignature /> },
            ].map((app) => (
              <div key={app.id} onClick={() => setActiveAgent(app.id)} className="bg-white border border-zinc-200 flex items-stretch hover:border-blue-600 hover:shadow-2xl transition-all cursor-pointer group rounded-sm shadow-sm overflow-hidden"><div className="w-20 bg-zinc-50 flex items-center justify-center text-zinc-400 group-hover:text-blue-600 transition-colors border-r border-zinc-100">{React.cloneElement(app.icon, { size: 32 })}</div><div className="p-6 flex-1 space-y-2"><div className="flex justify-between items-start"><h3 className="font-bold text-zinc-800 text-sm group-hover:text-blue-600 uppercase tracking-tight">{app.title}</h3><span className="text-[9px] font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-sm border border-emerald-100 italic uppercase">Operational</span></div><p className="text-[11px] text-zinc-500 font-bold italic leading-relaxed opacity-80">{app.desc}</p><div className="pt-4 flex items-center text-[10px] font-bold text-blue-600 opacity-0 group-hover:opacity-100 transition-all transform translate-y-1 group-hover:translate-y-0"><span>启动业务控制台</span><ChevronRight size={12} className="ml-1" /></div></div></div>
            ))}
          </div>
        </div>
      );
      case 'modelhub': return (
        <div className="p-8 space-y-8 animate-in fade-in">
           <div className="flex justify-between items-end border-b border-zinc-200 pb-4"><div><h2 className="text-xl font-bold text-zinc-800 tracking-tight uppercase italic">算力实例管理 / Instance Hub</h2><p className="text-[10px] text-zinc-400 font-bold uppercase tracking-widest mt-1 font-mono">Dedicated Inference Node Orchestration</p></div></div>
           <div className="bg-white border border-zinc-300 rounded-sm overflow-hidden shadow-xl shadow-zinc-100/50">
              <table className="w-full text-left text-[11px] font-sans font-bold">
                 <thead className="bg-[#f2f3f3] border-b border-zinc-300 text-zinc-600 font-bold uppercase tracking-tighter"><tr><th className="px-6 py-4">实例 ID / 名称</th><th className="px-6 py-4">状态</th><th className="px-6 py-4">部署环境</th><th className="px-6 py-4 text-center">延时</th><th className="px-4 py-4 text-right">操作</th></tr></thead>
                 <tbody className="divide-y divide-zinc-200 text-zinc-700">
                    {[{id:'local', n:'Legal-Private-S1', p:'本地算力', s:'Running', l:'12ms'}, {id:'qwen', n:'Qwen-Max-0224', p:'阿里云 VPC', s:'Ready', l:'42ms'}, {id:'deep', n:'DeepSeek-V3', p:'混合云网关', s:'Ready', l:'35ms'}].map((ins, i) => (
                      <tr key={i} className="hover:bg-blue-50/40 transition-colors group"><td className="px-6 py-4 font-mono"><div className="flex items-center space-x-3"><div className={`w-2 h-2 rounded-full ${ins.s === 'Running' ? 'bg-emerald-500' : 'bg-blue-400 animate-pulse'}`}></div><span>{ins.n}</span></div></td><td className="px-6 py-4 italic text-[10px] text-zinc-400 uppercase">{ins.s}</td><td className="px-6 py-4 flex items-center text-zinc-500"><Database size={12} className="mr-1.5 text-zinc-400"/>{ins.p}</td><td className="px-6 py-4 font-mono text-blue-600 text-center">{ins.l}</td><td className="px-4 py-4 text-right space-x-4"><button onClick={() => setTestModel({name:ins.n})} className="text-blue-600 hover:text-blue-800 underline underline-offset-4 uppercase tracking-tighter italic">Launch Console</button></td></tr>
                    ))}
                 </tbody>
              </table>
           </div>
        </div>
      );
      case 'settings': return <SettingsPage />;
      default: return <div className="p-20 text-center font-mono text-zinc-400 font-bold italic uppercase tracking-tighter font-sans">501 Error: Backend Handshake Failed</div>;
    }
  };

  return (
    <div className="flex flex-col h-screen bg-[#f1f3f4] font-sans text-zinc-900 overflow-hidden select-none">
      <GlobalHeader onReset={handleReset} />
      <div className="flex-1 flex overflow-hidden">
        <aside className="w-[240px] bg-white border-r border-zinc-300 flex flex-col z-10 shadow-[4px_0_12px_rgba(0,0,0,0.03)] shrink-0">
          <div className="p-4 border-b border-zinc-100 flex items-center justify-between bg-zinc-50/50 uppercase font-bold text-[10px] text-zinc-400 tracking-widest shrink-0"><span>Main Navigation</span><ChevronRight size={14} className="text-zinc-300" /></div>
          <nav className="flex-1 py-4 px-3 space-y-1.5 overflow-y-auto font-bold uppercase tracking-tight font-sans">
            {navigation.map((item) => (
              <button key={item.id} onClick={() => { setActiveTab(item.id); setActiveAgent(null); setTestModel(null); }} className={`w-full flex items-center space-x-3 px-4 py-3 rounded-sm transition-all text-xs ${activeTab === item.id && !activeAgent && !testModel ? 'bg-blue-50 text-blue-700 border border-blue-200 shadow-sm' : 'text-zinc-600 hover:bg-zinc-50 border border-transparent'}`}>
                {React.cloneElement(item.icon, { size: 16, className: (activeTab === item.id && !activeAgent && !testModel) ? 'text-blue-700' : 'text-zinc-400' })}
                <span>{item.label}</span>
              </button>
            ))}
          </nav>
          <div className="p-4 border-t border-zinc-100 shrink-0">
             <div className="bg-[#1a1c23] rounded-sm p-4 text-white space-y-2 relative overflow-hidden shadow-inner cursor-default">
                <p className="text-[10px] font-bold text-zinc-500 uppercase tracking-widest z-10 relative leading-none mb-1 font-mono tracking-tighter">BUILD v2.0.8</p>
                <p className="text-xs font-mono font-bold text-orange-400 z-10 relative uppercase tracking-tighter">ENTERPRISE_L5</p>
                <Cpu size={44} className="absolute -right-2 -bottom-2 text-white/5 rotate-12" />
             </div>
          </div>
        </aside>

        <main className="flex-1 flex flex-col min-w-0 bg-[#fbfbfb] relative overflow-hidden">
          {(!activeAgent && !testModel) && (
            <div className="h-10 bg-white border-b border-zinc-200 px-6 flex items-center justify-between shadow-sm z-10 font-bold uppercase tracking-widest text-[10px] shrink-0 font-sans">
               <div className="flex items-center space-x-2 text-zinc-500"><span className="hover:text-zinc-900 cursor-pointer transition" onClick={handleReset}>Legal Cloud</span><ChevronRight size={12} className="text-zinc-300" /><span className="text-zinc-900 border-b border-orange-500 pb-0.5 font-bold italic tracking-tight uppercase">{navigation.find(n => n.id === activeTab)?.label}</span></div>
               <div className="flex items-center space-x-5 text-zinc-400 italic"><span>Regional Cluster: SZ-HQ-01</span><div className="flex items-center space-x-2 group cursor-pointer hover:text-zinc-800 transition"><span>Health: Normal</span><div className="w-1.5 h-1.5 bg-emerald-500 rounded-full group-hover:animate-ping shadow-[0_0_8px_rgba(16,185,129,0.4)]"></div></div></div>
            </div>
          )}
          <div className="flex-1 overflow-auto bg-[#fbfbfb]">{renderContent()}</div>
        </main>
      </div>

      <AICopilotWrapper />
    </div>
  );
}

// --- 附加功能：悬浮 AI 算力助手 ---
const AICopilotWrapper = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [input, setInput] = useState('');
  const [msgs, setMsgs] = useState([{r:'ai',t:'你好，我是 Legal-AI 算力助手。我可以为您检索律所私有知识库，或者执行业务 Agent 调用指令。'}]);
  const scrollRef = useRef(null);
  const send = (e) => {
    e.preventDefault(); if(!input.trim()) return;
    const n = [...msgs, {r:'u',t:input}]; setMsgs(n); setInput('');
    setTimeout(() => setMsgs([...n, {r:'ai',t:'[VPC_INTERNAL] 正在为您检索本所《民事诉讼业务内控准则》... 发现 2 条匹配条款。'}]), 800);
  };
  useEffect(() => { if(scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight; }, [msgs, isOpen]);
  return (
    <div className="fixed bottom-6 right-6 z-[60] flex flex-col items-end">
      {isOpen && (
        <div className="w-[380px] h-[520px] bg-[#1a1c23] border border-zinc-700 rounded-lg shadow-2xl flex flex-col overflow-hidden animate-in slide-in-from-bottom-4 zoom-in-95">
          <div className="h-12 bg-[#232f3e] px-4 flex items-center justify-between border-b border-zinc-800 shrink-0 shadow-md">
             <div className="flex items-center space-x-2 text-white font-bold text-xs uppercase tracking-widest"><Sparkles size={14} className="text-orange-400" /><span>Legal-AI Copilot</span></div>
             <button onClick={()=>setIsOpen(false)} className="text-zinc-400 hover:text-white transition-colors"><X size={16} /></button>
          </div>
          <div ref={scrollRef} className="flex-1 overflow-y-auto p-4 space-y-4 font-mono text-[11px] bg-black/20">
            {msgs.map((m,i)=>(
              <div key={i} className={`flex ${m.r==='ai'?'justify-start':'justify-end'}`}>
                 <div className={`max-w-[85%] p-3 rounded-sm leading-relaxed shadow-lg ${m.r==='ai'?'bg-zinc-800/90 text-zinc-300 border-l-2 border-orange-500':'bg-blue-900/40 text-blue-100 border border-blue-800'}`}>
                   {m.r==='ai' && <div className="text-[9px] text-zinc-500 mb-1 font-bold uppercase tracking-tighter">Instance Output</div>}
                   {m.t}
                 </div>
              </div>
            ))}
          </div>
          <div className="p-4 border-t border-zinc-800 bg-[#1c222d] shrink-0">
             <form onSubmit={send} className="relative">
                <input value={input} onChange={(e)=>setInput(e.target.value)} type="text" placeholder="键入指令或法律问题..." className="w-full bg-zinc-900 border border-zinc-700 rounded-sm py-2.5 pl-4 pr-10 text-[11px] text-zinc-300 focus:outline-none focus:border-orange-500 font-mono shadow-inner" />
                <button type="submit" className="absolute right-2 top-1/2 -translate-y-1/2 text-zinc-500 hover:text-orange-500 transition-colors"><Send size={16} /></button>
             </form>
             <div className="mt-3 flex justify-between text-[9px] font-bold text-zinc-600 uppercase tracking-tighter"><span>Private Inference Mode Active</span><div className="flex items-center space-x-1"><Command size={10}/><span>K</span></div></div>
          </div>
        </div>
      )}
      {!isOpen && (
        <button onClick={()=>setIsOpen(true)} className="bg-orange-500 text-white p-4 rounded-full shadow-2xl hover:bg-orange-600 transition-all hover:scale-110 active:scale-95 group relative ring-4 ring-orange-500/20">
           <MessageSquare size={24} /><span className="absolute -top-1 -right-1 w-3.5 h-3.5 bg-red-600 rounded-full border-2 border-white animate-pulse"></span>
        </button>
      )}
    </div>
  );
};